<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SiwVideogames - Dettagli videogioco</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" th:href="@{/}">SiwVideogames</a>
			<div class="d-flex">
				<div th:if="${userDetails}">
					<span class="navbar-text text-white me-3" th:text="${userDetails.username}"></span>
					<a class="btn btn-outline-light" href="/logout">Logout</a>
				</div>
				<div th:unless="${userDetails}">
					<a class="btn btn-outline-light" href="/login">Login</a>
				</div>
			</div>
		</div>
	</nav>

	<div class="container my-5">
		<div class="row">
			<!-- Locandina -->
			<div class="col-md-3">
				<form class="" th:action="@{'/admin/saveVideogameImage/'+${videogame.id}}" method="POST"
					enctype="multipart/form-data">
					<label class="cursor-pointer text-light" for="modifyImage">
						<img class="img-fluid my-2 rounded-5 border border-2 border-primary px-0"
							th:src="${videogame.getPicPath()}" />
					</label>
					<input class="opacity-0" id="modifyImage" name="image" type="file" accept="image/*"
						onchange="form.submit()">
				</form>
			</div>

			<!-- Details -->
			<div class="col-md-8">
				<h1 class="mb-3" th:text="${videogame.title}">Titolo del gioco</h1>
				<p class="text-muted">
					<strong>Data di uscita:</strong>
					<span th:text="${videogame.releaseDate}">2023-01-01</span>
				</p>
				<p>
					<strong>Genere:</strong> <span th:text="${videogame.genre}">Action</span><br>
					<strong>Piattaforma:</strong> <span th:text="${videogame.platform}">PC</span><br>
					<strong>Publisher:</strong> <span th:if="${videogame.publisher != null}"
						th:text="${videogame.publisher.name}"></span>
					<span th:unless="${videogame.publisher != null}">Non ha un publisher</span>
				</p>
				<p th:text="${videogame.description}">
					Game descprition
				</p>

				<!-- Developers list -->
				<div>
					<strong>Developers:</strong>
					<ul>
						<li th:each="dev : ${videogame.developers}" th:text="${dev.name}">Developer Name</li>
					</ul>
				</div>

				<!-- Button back -->
				<a th:href="@{/videogame}" class="btn btn-primary mt-3">Torna al catalogo</a>
			</div>
		</div>

		<!-- Reviews -->
		<div th:each="review : ${videogame.reviews}" class="card mb-3">
			<div class="card-body">
				<h5 class="card-title">
					<span th:text="${review.author.credentials.username}">Author</span>
				</h5>
				<p class="card-text" th:text="${review.text}">Review text...</p>
				<p class="fw-bold">Rating: <span th:text="${review.rating}">8</span>/10</p>

				<div class="mt-3">
					<!-- Solo l'autore può modificare -->
					<a th:if="${userDetails != null and review.author.credentials.username == userDetails.username}"
						th:href="@{/review/{id}/edit(id=${review.id})}" class="btn btn-sm btn-warning me-2">Modifica</a>

					<!-- L'autore puo eliminare -->
					<a th:if="${userDetails != null and review.author.credentials.username == userDetails.username}"
						th:href="@{/review/{id}/delete(id=${review.id})}" class="btn btn-sm btn-danger">Elimina</a>
				</div>
			</div>
		</div>

		<div class="container my-5">
			<h2 class="mb-4">Lascia una recensione</h2>

			<form th:action="@{/videogame/{videogameId}/review(videogameId=${videogame.id})}" th:object="${newReview}"
				method="post">

				<!-- Testo recensione -->
				<div class="mb-3">
					<label for="text" class="form-label">Recensione</label>
					<textarea id="text" class="form-control" th:field="*{text}"
						placeholder="Scrivi qui la tua opinione..."></textarea>
				</div>

				<!-- Voto -->
				<div class="mb-3">
					<label for="rating" class="form-label">Voto (1–10)</label>
					<input type="number" id="rating" class="form-control" th:field="*{rating}" min="1" max="10"
						placeholder="Inserisci un voto da 1 a 10">
				</div>

				<!-- Pulsante -->
				<button type="submit" class="btn btn-primary">Invia Recensione</button>
			</form>
		</div>

	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>